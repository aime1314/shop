<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title><%= title %></title>
    <script src='https://res2.wx.qq.com/open/js/jweixin-1.4.0.js'></script>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel="stylesheet" href="/stylesheets/jquery-confirm.min.css">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <style>
        body,html{
            background: #fff;
            box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
        }
        .header{
            width:100%;
            box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
        }
        .organManage_box{
            width:100%;
            height:0.44rem;
            background:#f5f7f9;
            line-height: 0.44rem;
            padding-left: 0.29rem;
        }
        .custodian{
            color: #7f8592;
            font-size: 0.21rem;
        }
        .custodian_list{
            box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            width: 100%;
            padding: 0 0.29rem;
            clear: both;
            overflow: hidden;
        }
        .custodian_list li{
            height:0.53rem;
            display:flex;
            justify-content: space-between;
            align-items: center;
            padding:0.17rem 0;
        }
        .member_right{
            display: flex;
            width:2.97rem;
            justify-content: flex-end;
            align-items: center;
        }
        .member .memberInfo{
            display: flex;
            align-items: center;
            color:#898f9b;
            font-size: 0.24rem;
            line-height: 0.54rem;
            width:2.83rem;
        }
        .memberInfo .memberImg{
            width:0.53rem;
            height:0.53rem;
            margin-right: 0.14rem;  
            border-radius: 50%;
            -webkit-border-radius:50%;
            -moz-border-radius:50%;
        }
        .memberInfo #memberImg{
            width:0.53rem;
            height:0.53rem;
            margin-right: 0.14rem;  
            border-radius: 50%;
            -webkit-border-radius:50%;
            -moz-border-radius:50%;
            background: #3e8cf9;
            color:#fff;
            font-size: 0.21rem;
            text-align: center;
            line-height: 0.53rem;
        }
        .memberInfo .memberName{
            font-size: 0.24rem;
            line-height: 0.54rem;
            color:#000;
        }
        .member .vocation{
            font-size: 0.21rem;
            line-height: 0.54rem;
            color:#bbc1ce;
            width: 1.85rem;
            text-align: right;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
        .member .homepage_btn{
            width:1.29rem;
            height:0.43 rem;
            line-height: 0.54rem;
            background:#ebf3ff;
            border-radius: 0.20rem;
            -webkit-border-radius: 0.20rem;
            -moz-border-radius: 0.20rem;
            font-size: 0.20rem;
            color: #3e8cf9;
            text-align: center;
        }
        .custodian_list .line{
            width:5.42rem;
            height:1px;
            background:#f3f5f7;
            margin-left: 0.37rem;
        }
        .section{
            width:100%;
        }
        .otherMembers_box{
            width:100%;
            height:0.44rem;
            background:#f5f7f9;
            line-height: 0.44rem;
            padding-left: 0.29rem;
        }
        .otherMembers{
            color: #7f8592;
            font-size: 0.21rem;
        }
        .otherMembers_list{
            box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            width:100%;
            padding: 0 0.29rem;
            clear: both;
            overflow: hidden;
            margin: 0 auto;
        }
        .otherMembers_list li{
            height:0.53rem;
            display:flex;
            justify-content: space-between;
            align-items: center;
            padding:0.17rem 0;
        }
        .otherMembers_list .line{
            width:5.42rem;
            height:1px;
            background:#f3f5f7;
            margin-left: 0.37rem;
        }
        .article{
            position: fixed;
            bottom: 0;
            width:100%;
            height:1.06rem;
            background: rgba(255, 255, 255, .7);
        }
        .joinNow_btn{
            position: fixed;
            left: 0;
            margin: auto;
            right: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            bottom: 0.31rem;
            width:4.74rem;
            height: 0.768rem;
            font-size: 0.32rem;
            color:#fff;
            background: #3e8cf9;
            border-radius: 0.37rem;
            -webkit-border-radius:0.37rem;
            -moz-border-radius:0.37rem;
        }
        .dialog{
            position: fixed;
            top:0;
            bottom:0;
            left:0;
            right:0;
            display: none;
        }
        .dialog.active{
            display: block;
        }
        .dialog .bg{
            display: block;
            content: '';
            position: absolute;
            width:100%;
            height:100%;
            background: rgba(0,0,0,0.3);
        }
        .dialogcontent{
            position: absolute;
            left:50%;
            top:50%;
            -webkit-transform: translate(-50%,-50%);
            -moz-transform: translate(-50%,-50%);
            -ms-transform: translate(-50%,-50%);
            -o-transform: translate(-50%,-50%);
            transform: translate(-50%,-50%);
            z-index:1;
            width:5.6rem;
            height:7.6rem;
            padding:0 0.5rem;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            background-color: #fff;
        }
        .top-box{
            margin-bottom: 0.41rem;
            display: flex;
            justify-content: space-between;
            padding:0 0 0 0rem!important;
        }
        .dialogcontent .btn{
            margin-top:0.41rem;
            width:100%;
            background: #3e8cf9;
            color:#fff;
            height:0.74rem;
            line-height: 0.74rem;
            text-align: center;
            -webkit-border-radius: 3px;
            -moz-border-radius:3px;
            border-radius: 3px;
            font-size: 0.32rem;
        }
        .title{
            display: inline-block;
            font-size: 0.33rem;
            line-height: 0.33rem;
            color:#000;
            padding-top:0.58rem;
        }
        .title span{
            color:#3E8CF9;
        }
        .close{
            display: inline-block;
            padding-top: 0.3rem;
        }
        .close>img{
            display: block;
            width:0.54rem;
        }
        .dialogcontent .common{
            margin-top:0.31rem;
            border-bottom:1px solid #B8BEC9;
            height:0.76rem;
            display: flex;
            align-items: center;
            clear: both;
            overflow: hidden;
        }
        .dialogcontent .common:nth-child(1){
            margin-top: 0.38rem;
        }
        .dialogcontent .phone{
            display: block;
            width:0.27rem;
            height:0.3rem;
        }
        .dialogcontent .phone img{
            display: block;
            width:100%;
            height:100%;
        }
        .dialogcontent .common span{
            display: inline-block;
            color:#7F8592;
            font-size:0.3rem;
        }
        .dialogcontent input{
            border:none;
            font-size: 0.3rem;
        }
        .dialogcontent .phoneNum{
            margin-left: 0.24rem;
            width: 3.5rem;
        }
        #YZC{
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .yzCode{
            width:3.2rem;
        }
        #yzCode{
            width:1.42rem;
            height:0.47rem;
            border:1px solid rgba(181,186,197,1);
            border-radius:4px;
            font-size: 0.22rem;
            line-height: 0.47rem;
            text-align: center;
        }
        .agree{
            text-align: center;
            margin-top: 0.32rem;
            clear: both;
            overflow: hidden;
        }
        .agree span{
            font-size: 0.21rem;
        }
        .zj-box{
            margin-top: 0.65rem;
            clear: both;
            overflow: hidden;
            text-align: center;
        }
        .zj-box span{
            font-size: 0.28rem;
        }
        .jconfirm .jconfirm-box{
            width: 4.17rem;
            height: 1.96rem;
            background:#f7f7f7;
            border-radius: 12px;
            -webkit-border-radius:12px;
            -moz-border-radius:12px;
        }
        .jconfirm-content div:first-child{
            color:#000;
            font-size: 0.29rem;
        }
        .jconfirm.jconfirm-light .jconfirm-box .jconfirm-buttons{
            float: inherit;
            display: flex!important;
            justify-content: center;
            align-items: center;
        }
        .jconfirm.jconfirm-light .jconfirm-box .jconfirm-buttons button{
            color: #3478F6;
            font-size: 0.28rem!important;
            background: #f7f7f7;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="organManage_box">
            <div class="custodian">社群管理层（<%= information.managerCount %>人）</div>
        </div>
        <ul class="custodian_list">
            <% information.managerMemberList.forEach(function(item){ %>
            <li class="member">
                <p class="memberInfo">
                    <% if(item.imageUrl){ %>
                        <% if(item.imageUrl.indexOf("!") == -1){ %>
                            <img src="<%= item.imageUrl %>!/both/80x80" alt="" class="memberImg">
                        <% }else{ %>
                            <img src="<%= item.imageUrl %>" alt="" class="memberImg">
                        <% } %>
                    <% }else{ %>
                        <span id="memberImg"><%= ((item.realName.split("").reverse().join("")).substring(0,2)).split("").reverse().join("") %></span>
                    <% } %>
                    <span class="memberName"><%= item.realName %></span>
                    <% if(item.organPos == 1){ %>
                        <span>(创建者)</span>
                    <% }else if(item.organPos == 2){ %>
                        <span>(社群管理员)</span>
                    <% }else if(item.organPos == 3){ %>
                        <span>(参与者)</span>
                    <% } %>
                </p>
                <div class="member_right">
                    <p class="vocation"><%= item.businessNameList %></p>
                    <p class="homepage_btn" id="<%= item.memberId %>" onclick="homepage_btn('<%= item.memberId %>')">查看主页</p>
                </div>
            </li>
            <% }) %>
            <p class="line"></p>
        </ul>
    </header>
    <section class="section">
        <div class="otherMembers_box">
            <div class="otherMembers">社群其他成员（<%= information.joinedMemberCount %>人）</div>
        </div>
        <ul class="otherMembers_list">
            <% information.joinedMemberList.forEach(function(item){ %>
            <li class="member">
                <p class="memberInfo">
                    <% if(item.imageUrl){ %>
                        <% if(item.imageUrl.indexOf("!") == -1){ %>
                            <img src="<%= item.imageUrl %>!/both/80x80" alt="" class="memberImg">
                        <% }else{ %>
                            <img src="<%= item.imageUrl %>" alt="" class="memberImg">
                        <% } %>
                    <% }else{ %>
                        <span id="memberImg"><%= ((item.realName.split("").reverse().join("")).substring(0,2)).split("").reverse().join("") %></span>
                    <% } %>
                    <span class="memberName"><%= item.realName %></span>
                </p>
                <div class="member_right">
                    <p class="vocation"><%= item.businessNameList %></p>
                    <p class="homepage_btn" id="<%= item.memberId %>" onclick="homepage_btn('<%= item.memberId %>')">查看主页</p>
                </div>
            </li>
            <p class="line"></p>
            <% }) %>
        </ul>
    </section>
    <article class="article">
        <div class="joinNow_btn" onclick="showDialog()">立即加入</div>
    </article>
    <div class="dialog" id="dialog">
        <div class="dialogcontent">
            <div class="top-box">
                <p class="title">
                    使用此功能请先
                    <span>注册群脉</span>
                </p>
                <p class="close">
                    <img src="/images/close.png"  class="right" alt="" onclick="closeDialog()">
                </p>
            </div>
            <div class="common">
                <p class="phone"><img src="/images/ico-phone.png" alt="手机号"></p>
                <span>+86</span>
                <input type="number" class="phoneNum" id="phone" placeholder="请输入手机号">
            </div>
            <div class="common" id="YZC">
                <input type="text" id="yzCodeNum" class="yzCode" placeholder="输入验证码">
                <span id="yzCode" onclick="getCode(this)">获取验证码</span>
            </div>
            <div class="common">
                <input type="text" id="name" placeholder="输入真实姓名"">
            </div>
            <div class="btn" onclick="register()">立即注册</div>
            <p class="agree">
                <span style="color: #B5BAC5;">点击以上按钮即表示同意</span>
                <span style="color: #89B3FB;" onclick="privacyZC()">《隐私权声明》</span>
            </p>
            <p class="zj-box">
                <span style="color: #7F8592;">已有账号？</span>
                <span style="color: #3E8CF9;text-decoration:underline;" onclick="openAPP()">打开APP</span>
            </p>
        </div>
        <div class="bg" onclick="closeDialog()"></div>
    </div>

    <script src="/javascripts/jquery.min.js"></script>
    <script src="/javascripts/webcommon.js"></script>
    <script src="/javascripts/jquery-confirm.min.js"></script>
    <script>
        var wxWebshareDb = {
            "title":'查看更多人员',                                  // 分享标题
            "link":window.location.href,                // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
            "desc": "玩社群，用群脉",             // 分享描述
            "imgUrl" : '',         //分享图标
            // "type": '',                                        // 分享类型,music、video或link，不填默认为link
            // "dataUrl": ''                                    // 如果type是music或video，则要提供数据链接，默认为空
        };
    </script>
    <script src="/javascripts/wxcommon.js"></script>
    
    <script>
        function homepage_btn(memberId){
            // console.log(memberId);
            window.location.href = "/share/personalPage?memberId=" + memberId;
        }
        var timer;
        function showDialog(){
            var ele=document.getElementById("dialog")
            ele.classList.add("active")
        }
        function closeDialog(){
            var ele=document.getElementById("dialog")
            ele.classList.remove("active")
            var yzCode=document.getElementById("yzCode")
            //关闭弹窗，清除计时器
            var inputs=document.getElementsByTagName("input")
            for(var i =0 ;i<inputs.length;i++){
                inputs[i].value=""
            }
            clearInterval(timer)
            yzCode.innerText="发送验证码"
            yzCode.classList.remove("active")
        }
        function privacyZC(){
            window.location.href = "/appCorrelation/correlationPage/privacy";
        }
        function openAPP(){
            alert("打开APP");             //TODO
        }
        function getCode(el){
            // console.log(el)

            if(timer){
                //已经在计时了
                return;
            }else{
                el.classList.remove("active")
            }
            var phoneNum=document.getElementById("phone").value
            if(!(/^1[3456789]\d{9}$/.test(phoneNum) &&  phoneNum.length == 11)){
                poper("请输入正确的电话号")
                return;
            }else{
                $.ajax({
                    type:"get",
                    url:"/users/wap/getyzCode"+location.search+"&phoneNum="+phoneNum,
                    success:function(res){
                        // console.log(res)
                        if(res.errorCode==0){
                            el.classList.add("active")
                            var count=120;
                            el.innerText=count+"s"
                            timer=setInterval(function(){
                                if(count>1){
                                    count--;
                                    el.innerText=count+"s"
                                }else{
                                    el.innerText="发送验证码"
                                    el.classList.remove("active")
                                    clearInterval(timer)
                                }
                            },1000)
                        }else if(res.errorCode == 04 || res.message == "用户已注册"){
                            var ele=document.getElementById("dialog")
                            ele.classList.remove("active");
                            $.confirm({
                                title: '',
                                content: '该手机号码已被注册，是否立即打开群脉APP?',
                                animation: 'top',
                                buttons: {
                                    ok: {
                                        text: "取消",
                                        btnClass: 'btn-primary',
                                        keys: ['enter'],
                                        action: function() {

                                        }
                                    },
                                    cancel: {
                                        text: "立即打开",
                                        btnClass: 'btn-primary',
                                        keys: ['esc'],
                                        action: function() {
                                            alert("打开APP")            //TODO

                                        }
                                    }
                                }
                            });
                        }else{
                            poper(res.message)
                        }

                    },
                    error:function(err){
                        
                    }

                })
            }

        }
        function register(){
            var phoneNum=$("#phone").val();
            var yzCode=$("#yzCodeNum").val();
            var name=$("#name").val();
            if(phoneNum && yzCode && name){
                $.ajax({
                    type:"POST",
                    url:"/users/wap/register",
                    contentType:"application/x-www-form-urlencoded",
                    data:{
                        phoneNum:phoneNum,
                        yzCode:yzCode,
                        name:name
                    },
                    success:function(res){
                        if(res.errorCode==0){
                            // $.ajax({
                            //     type: "get",
                            //     url: "/api/addOrgan?organId=" + organId,
                            //     success: function(res){
                            //         window.location.href = "https://www.baidu.com/";   
                            //     },
                            //     error: function(err){
                                   
                            //     }
                            // })
                            window.location.href = "/login/regSuccess"
                        }else{
                            poper(res.message)
                        }
                    },
                    error:function(err){
                        poper("网络连接错误，请稍后再试")
                    }
                })
            }else{
                poper("注册信息填写不完整")
            }
        }
    </script>
</body>
</html>