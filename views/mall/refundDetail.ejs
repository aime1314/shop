<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="referrer" content="no-referrer"/>
    <title><%= title %></title>
    <link rel="stylesheet" href="/stylesheets/base.css">
    <script src="/javascripts/phone.js"></script>
    <style>
    	.detail_top{
			height: 100px;
			background: #FF6612;
			text-align: center;
		}
		.detail_top_two{
			padding-top: 20px;
			line-height: 30px;
			font-size: 28px;
			font-weight: bold;
			color: #FFFFFF;
		}
		.detail_top_two span{
			font-size: 22px;
			font-weight: normal;
		}
    	.refund_box{
    		padding: 24px 24px 0px 24px;
    		background: #FFFFFF;    		
    	}
    	.refund_box h1{
    		line-height: 42px;
    		font-size: 28px;
    		font-weight: 600;
    		color: #2C2C2C;
    	}
    	.refund_box p{
    		display: block;
    		line-height: 36px;
    		font-size: 24px;
    		color: #6A6C72;
    		display: flex;
    		justify-content:flex-start;
    	}
    	.refund_p{
    		margin-top: 12px;
    	}
    	.refund_i{
    		margin-right: 10px;
    	}
    	.refund_t{
    		display: block;
    	}
    	.refund_bor{
    		padding-bottom: 12px;
    		border-bottom: 1px solid #F5F7F9;
    	}
    	.refund_addr_box{
    		padding: 24px;
    		background: #FFFFFF; 
    	}
    	.refund_addr_box2{
    		padding-bottom: 24px;
    		height: 184px;
    		line-height: 184px;
    		text-align: center;
    		background: #FFFFFF; 
    		border-bottom: 1px solid #F5F7F9;
    	}
    	.refund_addr_tit{
    		display: flex;
    		align-items: center;
    		font-size: 28px;
    		font-weight: bold;
    		color: #2c2c2c;
    	}
    	.refund_addr_tit img{
    		margin-right: 11px;
    		width: 36px;
    		height: 36px;
    	}
    	.refund_addr_con{
    		display: flex;
    		align-items: center;
    		justify-content: space-between;
    	}
    	.addr_con_l{
    		margin-top: 12px;
    		border-bottom: 1px solid #F5F7F9;
    	}
    	.addr_con_l p{
    		margin-bottom: 12px;
    		line-height: 40px;
    		font-size: 28px;
    		color: #2C2C2C;
    	}
    	.refund_addr_con img{
    		width: 54px;
    		height: 54px;
    	}
    	.order_ope{
			padding-top: 21px;
			display: flex;
			flex-direction: row-reverse;
		}
		.order_btn{
			margin-left:22px;
			padding: 0px 20px;
			height: 54px;
			line-height: 54px;
			font-size: 24px;
			color: #6A6C72;
			border: 1px solid #B6B6BD;
			border-radius: 27px
		}
		.orage{
			color: #FF6A29;
			border: 1px solid #FF6A29;
		}
		.detail_amount{
			padding: 24px 24px;
			background: #FFFFFF;
			border-bottom: 1px solid #f7f6f9;
			display: flex;
			justify-content: space-between;
		}
		.detail_gray{
			font-size: 30px;
			color: #2c2c2c;
		}
		.detail_orage{
			font-size: 30px;
			color: #FF6A29;
		}
		.refund_infor_tit{
			margin-top: 12px;
			padding: 24px;
			background: #FFFFFF;
			font-size: 30px;
			color: #2C2C2C;
		}
		.comm_inf {
			padding: 14px 24px;
			border-bottom: 1px solid #f7f6f9;
			display: flex;
		}
		
		.comm_pic {
			width: 120px;
			height: 120px;
		}
		
		.comm_inf_box {
			width: 81%;
			margin-left: 15px;
		}
		
		.order_box {
			display: flex;
			flex-wrap: nowrap;
			justify-content: space-between;
		}
		
		.comm_tit {
			font-size: 28px;
			color: #2C2C2C;
			height: 30px;
			line-height: 30px;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}
		
		.comm_num {
			line-height: 30px;
			font-size: 24px;
			color: #2C2C2C;
		}
		
		.comm_num span {
			font-size: 22px;
		}
		
		.comm_num2 {
			margin-top: 15px;
			display: flex;
			flex-wrap: nowrap;
			justify-content: space-between;
		}
		
		.comm_num_box {
			font-size: 26px;
			color: #AFAFB2;
		}
		
		.deduction_num {
			margin-top: 10px;
			text-align: right;
			font-size: 23px;
			color: #A5A8B2;
		}
		.order_info{
			padding: 15px 24px;
			border-bottom: 1px solid #F5F7F9;
		}
		.order_info p{
			margin: 15px 0px;
			height: 32px;
			line-height: 32px;
			font-size: 24px;
			color: #2C2C2C;
		}
		.order_info p span{
			color: #3086DE;
		}
		.comm_box {
			/*margin-top: 12px;*/
			margin-bottom: 109px;
			background: #ffffff;
		}
		.detail_contact{
			position: fixed;
			bottom: 0;
			left: 0;
			width: 100%;
			height: 96px;
			background: #FFFFFF;
			border-top: 1px solid #e9ecee;
			display: flex;
			align-items: center;
			justify-content: space-between;
		}
		.detail_con_box{
			width: 50%;
			text-align: center;
			font-size: 28px;
			color: #6A6C72;
		}
		.bord{
			border-right: 2px solid #F5F7F9;
		}
		.detail_con_box img{
			margin-right: 10px;
			width: 42px;
			height: 42px;
		}
		/*选择弹框*/
       .weui-mask {
		    position: fixed;
		    z-index: 1000;
		    top: 0;
		    right: 0;
		    left: 0;
		    bottom: 0;
		    background: rgba(0,0,0,0.6);
		}
		.weui-actionsheet {
		    position: fixed;
		    left: 0;
		    bottom: 0;
		    z-index: 5000;
		    width: 100%;
		    background-color: #f7f7f7;
		    -webkit-transition: -webkit-transform 0.3s;
		    transition: -webkit-transform 0.3s;
		    transition: transform 0.3s;
		    transition: transform 0.3s,-webkit-transform 0.3s;
		    overflow: hidden;
		}
		.weui-actionsheet__menu {
		    color: rgba(0,0,0,0.9);
		    background-color: #fff;
		}
		.weui-actionsheet__cell {
		    position: relative;
		    padding:0 16px;
		    text-align: center;
		    font-size: 36px;
		    color: #2C2C2C;
		    line-height: 114px;
		}
		.weui-actionsheet__action {
		    margin-top: 8px;
		    background-color: #fff;
		    padding-bottom: constant(safe-area-inset-bottom);
		    padding-bottom: env(safe-area-inset-bottom);
		}
		/*操作提示*/
		.weui-dialog{
			text-align: left;
		}
		.weui-dialog__bd{
			padding: 38px 24px;
		}
    </style>
</head>
<body>
    <div id="app">
        <div class="page" v-cloak>
            <div class="wrapper">
                <main class="content">
                	<div class="detail_top">
						<p class="detail_top_two">{{orderDetail.refundStatus == 101 && "等待卖家处理" || orderDetail.refundStatus == 102 && "商家拒绝接单"|| orderDetail.refundStatus == 103 && "平台退款" ||
							orderDetail.refundStatus == 201 && "退款处理中"|| orderDetail.refundStatus == 202 && "退款处理中"||
							orderDetail.refundStatus == 301 && "申请被拒绝"|| orderDetail.refundStatus == 302 && "申请已撤销"|| orderDetail.refundStatus == 401 && "申请退款成功"}}</p>
                		<!-- <p class="detail_top_two">等待卖家处理<br><span>还剩2天23小时59分</span></p> -->
					</div>
					<!--等待卖家处理-->
					<template v-if="orderDetail.refundStatus == 101 && orderDetail.refundType == 1">
						<div class="detail_con_cl">
							<div class="refund_box">
								<h1>您已成功发起退款申请，请耐心等待卖家处理：</h1>
								<p class="refund_p"><span class="refund_i">· </span><span class="refund_t">发起退款申请后，请与卖家协商退款具体事宜</span></p>
								<p><span class="refund_i">· </span><span class="refund_t">如卖家拒绝，您可以修改申请后再次发起，卖家会重新处理</span></p>
								<p class="refund_bor"><span class="refund_i">· </span><span class="refund_t">如卖家超时未处理，退款申请将达成</span></p>
							</div>
							<div class="refund_addr_box">
								<div class="order_ope">
									<div class="order_btn orage" @click="editRefund">修改申请</div>
									<div class="order_btn" @click="refundCancel">撤销申请</div>
								</div>
							</div>
						</div>
					</template>
					<template v-if="orderDetail.refundStatus == 101 && orderDetail.refundType == 2">
						<div class="detail_con_cl">
							<div class="refund_box">
								<h1>您已成功发起退货退款申请，请仔细阅读以下说明并按照 退货信息进行退货：</h1>
								<p class="refund_p"><span class="refund_i">· </span><span class="refund_t">与卖家协商后，请按照给出的退货信息退货，并记录退货运单号</span></p>
								<p><span class="refund_i">· </span><span class="refund_t">如卖家拒绝，您可以修改申请后再次发起，卖家会重新处理</span></p>
								<p class="refund_bor"><span class="refund_i">· </span><span class="refund_t">如卖家超时未处理，退货申请将达成，请按系统给出的退货地址 退货</span></p>
							</div>
							<div class="refund_addr_box" v-if="isRetrunAddress">
								<div class="refund_addr_info" v-if="Object.keys(returnAddress).length > 0">
									<div class="refund_addr_tit"><img src="/images/shop_icon6.png" />退货地址：</div>
									<div class="refund_addr_con">
										<div class="addr_con_l">
											<p>{{returnAddress.province}}{{returnAddress.city}}{{returnAddress.area}}{{returnAddress.address}}{{returnAddress.addrName}}</p>
											<p>联系电话：{{returnAddress.telephone}}</p>
										</div>
										<img @click="changeCopy" src="/images/refund_addr.png" />
									</div>
								</div>
								<!--无退货地址-->
								<div class="refund_addr_box2" v-else>请联系卖家获取退货地址！</div>
								<div class="order_ope">
									<div class="order_btn orage" @click="editRefund">修改申请</div>
									<div class="order_btn" @click="refundCancel">撤销申请</div>
								</div>
							</div>
						</div>
					</template>
					<template v-if="orderDetail.refundStatus == 301">
						<div class="detail_con_cl">
							<div class="refund_box">
								<h1>您本次售后申请已被拒绝，可与卖家协商后再次申请。</h1>
							</div>
							<div class="refund_addr_box">
								<div class="order_ope">
									<div class="order_btn orage" @click="editRefund">再次申请</div>
								</div>
							</div>
						</div>
					</template>
					<!--申请撤销-->
					<template v-if="orderDetail.refundStatus == 302">
						<div class="detail_box_cx">
							<div class="refund_box">
								<h1>您已撤销了本售后单，可与卖家协商后再次申请。</h1>
							</div>
							<div class="refund_addr_box">
								<div class="order_ope">
									<div class="order_btn orage" @click="editRefund">再次申请</div>
								</div>
							</div>
						</div>
					</template>
					<!--申请成功-->
					<template v-if="orderDetail.refundStatus == 401">
						<div class="detail_box_cg">
							<div class="detail_amount">
								<span class="detail_gray">退款总金额</span>
								<span class="detail_orage">¥ {{orderDetail.refundAmount}}</span>
							</div>
							<div class="detail_amount">
								<span class="detail_gray">退回{{orderDetail.payType}}支付宝</span>
								<span class="detail_orage">¥ {{orderDetail.refundAmount}}</span>
							</div>
						</div>
					</template>
                    <!--退款信息-->
                    <div class="refund_infor_tit">退款信息</div>
                    <div class="comm_inf" v-for="(item, index) in orderRefundDetailList" :key="index">
						<img class="comm_pic" :src="item.pic" />
						<div class="comm_inf_box">
							<div class="order_box">
								<div class="comm_tit">{{item.skuName}}</div>
								<div class="comm_num"><span>￥</span>{{item.goodsPrice}}</div>
							</div>
							<div class="comm_num2">
								<div class="comm_num_box">{{item.goodsAttr}}</div>
								<div class="comm_num_box">x{{item.goodsCount}}</div>
							</div>
							<p class="deduction_num">脉粒抵扣:- ¥{{item.maiLiCount}}</p>
						</div>
					</div>
					<template v-if="Object.keys(orderDetail).length > 0">
						<div class="comm_box mar_bottom">
							<div class="order_info">
								<p>售后类型：{{orderDetail.refundType == 1 && '仅退款' || orderDetail.refundType == 2 && '退货退款'}}</p>
								<p>退款原因：{{orderDetail.reason}}</p>
								<p>退款金额：¥ {{orderDetail.refundAmount}}</p>
								<p>退还脉粒：{{orderDetail.refundMaiLi}}脉粒</p>
								<p>退款说明：{{orderDetail.buyerMsg}}<template v-if="orderDetail.photoFiles.length != 0"><span @click="toPage('/mall/refundImgDetail?photoFiles=' + orderDetail.photoFiles)">查看凭证</span></template></p>
								<p>退款编号：{{orderDetail.refundCode}}</p>
								<p>申请时间：{{orderDetail.creatTime | formatDate}}</p>
							</div>
						</div>
					</template>
					<div class="detail_contact">
						<div class="detail_con_box bord"><img src="/images/shop_wx.png">联系卖家</div>
						<div class="detail_con_box"><img src="/images/shop_tel.png">拨打电话</div>
					</div>
                </main>
            </div>
		</div>
		<template v-if="isShowCopyDialog">
			<div class="weui-mask">
				<div class="weui-actionsheet">
					<div class="weui-actionsheet__menu">
						<div class="weui-actionsheet__cell bor" @click="copyText('all')">复制全部退货信息</div>
						<div class="weui-actionsheet__cell" @click="copyText('address')">复制地址</div>
						<div class="weui-actionsheet__cell" @click="copyText('phone')">复制电话</div>
					</div>
					<div class="weui-actionsheet__action">
						<div class="weui-actionsheet__cell" @click="changeCopy">取消</div>
					</div>
				</div>
			</div>
		</template>
    </div>
    <!--操作提示-->
    <div class="js_dialog" id="iosDialog1" style="display: none;">
		<div class="weui-mask"></div>
		<div class="weui-dialog">
			<div class="weui-dialog__bd">取消退款申请后，本次退款将关闭，您可以再次发起退款/退货。确定要撤销吗？</div>
			<div class="weui-dialog__ft">
				<a href="javascript:" class="weui-dialog__btn weui-dialog__btn_default">取消</a>
				<a href="javascript:" class="weui-dialog__btn weui-dialog__btn_primary">确定</a>
			</div>
		</div>
	</div>
	<script src="/javascripts/vue.min.js"></script>
	<script src="/javascripts/axios.min.js"></script>
	<script src="/javascripts/webcommon.js"></script>
	<script>
		new Vue({
			el: "#app",
			data() {
				return {
					refundCode: `<%- refundCode %>`,
					orderDetail: {},
					orderRefundDetailList: [],
					pageIndex: 1,
					pageSize: 20,
					refundStatus: 0,
					list: [],
					isRetrunAddress: false,
					returnAddress: {},
					isShowCopyDialog: false
				}
			},
			created() {
				// refundStatus
				// 101 买家申请退款，等待卖家同意； 102 商家拒单；103 平台退款。
				// 201 卖家同意,等待退款; 202 卖家超时，系统自动确认，等待退款。
				// 301 卖家拒绝退款，关闭; 302 买家撤消退款，关闭。
				// 401 退款成功
				// 0：全部
				this.initData();
			},
			filters: {
				formatDate(value) {
					let date = new Date(value * 1000);
					let y = date.getFullYear();
					let MM = date.getMonth() + 1;
					MM = MM < 10 ? ('0' + MM) : MM;
					let d = date.getDate();
					d = d < 10 ? ('0' + d) : d;
					let h = date.getHours();
					h = h < 10 ? ('0' + h) : h;
					let m = date.getMinutes();
					m = m < 10 ? ('0' + m) : m;
					let s = date.getSeconds();
					s = s < 10 ? ('0' + s) : s;
					return y + '-' + MM + '-' + d + ' ' + h + ':' + m + ':' + s;
				}
			},
			methods: {
				initData() {
					axios.get("/mall/getRefundDetail?refundCode=" + this.refundCode).then(res => {
						this.orderDetail = res.data.data;
						this.orderRefundDetailList = res.data.data.orderRefundDetailList;
						if(res.data.data.refundStatus == 101) {
							this.getReturnAddress(this.orderDetail.shelfId);
						}
					});
				},
				getReturnAddress(shelfId) {
					axios.get("/mall/getReturnAddress?shelfId=" + shelfId).then(res => {
						console.log(res);
						this.isRetrunAddress = true;
						if(!res.data.data) {
						}else {
							this.returnAddress = res.data.data.list[0];
						}
					})
				},
				// 修改申请
				editRefund() {
					window.location.href = "/mall/editRefund?refundCode=" + this.refundCode;
				},
				// 撤销申请
				refundCancel() {
					axios.get("/mall/refundCancel?refundCode=" + this.refundCode).then(res => {
						if (res.data.errorCode == 0) {
                            window.history.go(-1);
                        }else {
                            return poper(res.data.message);
                        }
					});
				},
				changeCopy() {
					this.isShowCopyDialog ? this.isShowCopyDialog = false : this.isShowCopyDialog = true;
				},
				copyText(type) {
					let str;
					if(type == "all") {
						str = this.returnAddress.telephone + "," + this.returnAddress.province + this.returnAddress.city + this.returnAddress.area + this.returnAddress.address;
					}else if(type == "address") {
						str = this.returnAddress.province + this.returnAddress.city + this.returnAddress.area + this.returnAddress.address;
					}else if(type == "phone") {
						str = this.returnAddress.telephone;
					}
					let result = h5Copy(str);
					if(result == true) {
						this.isShowCopyDialog = false;
						return poper("复制成功");
					}else {
						return poper("复制失败");
					}
				},
				toPage(page) {
					window.location.href = page;
                },
			}
		})
	</script>
</body>
</html>